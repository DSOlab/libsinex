name: Linux CI build

on:
  push:
    branches: [ "main", "dev" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Your repo
      - name: Checkout main repo
        uses: actions/checkout@v4

      - name: Install system dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y libeigen3-dev

      # ---- ggdatetime ----
      - name: Check out ggdatetime
        uses: actions/checkout@v4
        with:
          repository: xanthospap/ggdatetime
          path: ggdatetime

      - name: Build & install ggdatetime (Release)
        working-directory: ggdatetime
        run: |
          cmake -S . -B build \
                -DCMAKE_BUILD_TYPE=Release \
                -DCMAKE_PREFIX_PATH=/usr/local/lib
          cmake --build build --target all --config Release
          sudo cmake --install build

      # ---- ggeodesy ----
      - name: Check out ggeodesy
        uses: actions/checkout@v4
        with:
          repository: xanthospap/ggeodesy
          path: ggeodesy

      - name: Build & install ggeodesy (Release)
        working-directory: ggeodesy
        run: |
          cmake -S . -B build \
                -DCMAKE_BUILD_TYPE=Release \
                -DCMAKE_PREFIX_PATH=/usr/local/lib
          cmake --build build --target all --config Release
          sudo cmake --install build

      # ---- This project: GCC, Release ----
      - name: Configure (Release, GCC)
        run: |
          cmake -S . -B build-gcc-release \
                -DCMAKE_BUILD_TYPE=Release \
                -DCMAKE_PREFIX_PATH=/usr/local/lib

      - name: Build (Release, GCC)
        run: cmake --build build-gcc-release --target all --config Release

      # Optional: run tests if you have CTest tests set up
      - name: Run tests (GCC, Release)
        working-directory: build-gcc-release
        run: ctest --output-on-failure

      # ---- This project: Clang, Release ----
      - name: Configure (Release, Clang)
        env:
          CC: clang
          CXX: clang++
        run: |
          cmake -S . -B build-clang-release \
                -DCMAKE_BUILD_TYPE=Release \
                -DCMAKE_PREFIX_PATH=/usr/local/lib

      - name: Build (Release, Clang)
        run: cmake --build build-clang-release --target all --config Release
